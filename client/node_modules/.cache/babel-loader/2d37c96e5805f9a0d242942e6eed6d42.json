{"ast":null,"code":"import { AUTH } from '../types/authType';\nimport { ALERT } from '../types/alertType';\nimport { checkImage, imageUpload } from '../../utils/ImageUpload';\nimport { patchAPI, getAPI } from '../../utils/FetchData';\nimport { checkPassword } from '../../utils/Valid';\nimport { GET_OTHER_INFO } from '../types/profileType';\nimport { checkTokenExp } from '../../utils/checkTokenExp';\nexport const updateUser = (avatar, name, auth) => async dispatch => {\n  if (!auth.access_token || !auth.user) return;\n  const result = await checkTokenExp(auth.access_token, dispatch);\n  const access_token = result ? result : auth.access_token;\n  let url = '';\n\n  try {\n    dispatch({\n      type: ALERT,\n      payload: {\n        loading: true\n      }\n    });\n\n    if (avatar) {\n      const check = checkImage(avatar);\n      if (check) return dispatch({\n        type: ALERT,\n        payload: {\n          errors: check\n        }\n      });\n      const photo = await imageUpload(avatar);\n      url = photo.url;\n    }\n\n    dispatch({\n      type: AUTH,\n      payload: {\n        access_token: auth.access_token,\n        user: { ...auth.user,\n          avatar: url ? url : auth.user.avatar,\n          name: name ? name : auth.user.name\n        }\n      }\n    });\n    const res = await patchAPI('user', {\n      avatar: url ? url : auth.user.avatar,\n      name: name ? name : auth.user.name\n    }, access_token);\n    dispatch({\n      type: ALERT,\n      payload: {\n        success: res.data.msg\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: ALERT,\n      payload: {\n        errors: err.response.data.msg\n      }\n    });\n  }\n};\nexport const resetPassword = (password, cf_password, token) => async dispatch => {\n  const result = await checkTokenExp(token, dispatch);\n  const access_token = result ? result : token;\n  const msg = checkPassword(password, cf_password);\n  if (msg) return dispatch({\n    type: ALERT,\n    payload: {\n      errors: msg\n    }\n  });\n\n  try {\n    dispatch({\n      type: ALERT,\n      payload: {\n        loading: true\n      }\n    });\n    const res = await patchAPI('reset_password', {\n      password\n    }, access_token);\n    dispatch({\n      type: ALERT,\n      payload: {\n        success: res.data.msg\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: ALERT,\n      payload: {\n        errors: err.response.data.msg\n      }\n    });\n  }\n};\nexport const getOtherInfo = id => async dispatch => {\n  try {\n    dispatch({\n      type: ALERT,\n      payload: {\n        loading: true\n      }\n    });\n    const res = await getAPI(`user/${id}`);\n    dispatch({\n      type: GET_OTHER_INFO,\n      payload: res.data\n    });\n    dispatch({\n      type: ALERT,\n      payload: {}\n    });\n  } catch (err) {\n    dispatch({\n      type: ALERT,\n      payload: {\n        errors: err.response.data.msg\n      }\n    });\n  }\n};","map":{"version":3,"names":["AUTH","ALERT","checkImage","imageUpload","patchAPI","getAPI","checkPassword","GET_OTHER_INFO","checkTokenExp","updateUser","avatar","name","auth","dispatch","access_token","user","result","url","type","payload","loading","check","errors","photo","res","success","data","msg","err","response","resetPassword","password","cf_password","token","getOtherInfo","id"],"sources":["/Users/esen/Desktop/FIBO homework/client/src/redux/actions/userAction.ts"],"sourcesContent":["import { Dispatch } from 'redux'\nimport { IAuth, IAuthType, AUTH } from '../types/authType'\nimport { IAlertType, ALERT } from '../types/alertType'\n\nimport { checkImage, imageUpload } from '../../utils/ImageUpload'\nimport { patchAPI, getAPI } from '../../utils/FetchData'\nimport { checkPassword } from '../../utils/Valid'\n\nimport { \n  GET_OTHER_INFO,\n  IGetOtherInfoType\n} from '../types/profileType'\n\nimport { checkTokenExp } from '../../utils/checkTokenExp'\n\n\nexport const updateUser = (\n  avatar: File, name: string, auth: IAuth\n) => async (dispatch: Dispatch<IAlertType | IAuthType>) => {\n  if(!auth.access_token || !auth.user) return;\n\n  const result = await checkTokenExp(auth.access_token, dispatch)\n  const access_token = result ? result : auth.access_token\n\n  let url = '';\n  try {\n    dispatch({ type: ALERT, payload: {loading: true}})\n    if(avatar){\n      const check = checkImage(avatar)\n      if(check) \n        return dispatch({ type: ALERT,payload: { errors: check } })\n\n      const photo = await imageUpload(avatar)\n      url = photo.url\n    }\n\n    dispatch({ \n      type: AUTH,\n      payload: {\n        access_token: auth.access_token,\n        user: {\n          ...auth.user,\n          avatar: url ? url : auth.user.avatar, \n          name: name ? name : auth.user.name\n        }\n      } \n    })\n\n    const res = await patchAPI('user', { \n      avatar: url ? url : auth.user.avatar, \n      name: name ? name : auth.user.name\n    }, access_token)\n\n    dispatch({ type: ALERT, payload: {success: res.data.msg}})\n\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: {errors: err.response.data.msg}})\n  }\n}\n\n\nexport const resetPassword = (\n  password: string, cf_password: string, token: string\n) => async (dispatch: Dispatch<IAlertType | IAuthType>) => {\n  const result = await checkTokenExp(token, dispatch)\n  const access_token = result ? result : token\n\n  const msg = checkPassword(password, cf_password)\n  if(msg) return dispatch({ type: ALERT, payload: {errors: msg}})\n\n  try {\n    dispatch({ type: ALERT, payload: {loading: true}})\n\n    const res = await patchAPI('reset_password', { password }, access_token)\n\n    dispatch({ type: ALERT, payload: {success: res.data.msg}})\n\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: {errors: err.response.data.msg}})\n  }\n}\n\n\nexport const getOtherInfo = (id: string) => \nasync (dispatch: Dispatch<IAlertType | IGetOtherInfoType>) => {\n  try {\n    dispatch({ type: ALERT, payload: {loading: true}})\n\n    const res = await getAPI(`user/${id}`)\n\n    dispatch({\n      type: GET_OTHER_INFO,\n      payload: res.data\n    })\n\n    dispatch({ type: ALERT, payload: { }})\n\n  } catch (err: any) {\n    dispatch({ type: ALERT, payload: {errors: err.response.data.msg}})\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}